{% load humanize %}
<tr id="transaction-row-{{ transaction.pk }}"
    class="border-b border-gray-100 transition-colors duration-200
           {% if transaction.status == 'voided' %}
               bg-gray-50/50 text-gray-400
           {% else %}
               hover:bg-gray-50 text-gray-700
           {% endif %}">
    <!-- DATE -->
    <td class="px-4 py-3 text-xs whitespace-nowrap">
        {{ transaction.created_at|date:"M d, Y" }}
        <span class="block text-[10px] text-gray-400">{{ transaction.created_at|date:"H:i" }}</span>
    </td>
    <!-- REFERENCE -->
    <td class="px-4 py-3 font-mono text-xs whitespace-nowrap">{{ transaction.reference_number }}</td>
    <!-- TYPE (Badge) -->
    <td class="px-4 py-3 text-center">
        {% if transaction.transaction_type == 'deposit' %}
            <span class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold uppercase bg-green-100 text-green-700 border border-green-200">
                Deposit
            </span>
        {% elif transaction.transaction_type == 'withdrawal' %}
            <span class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold uppercase bg-red-100 text-red-700 border border-red-200">
                Withdrawal
            </span>
        {% elif transaction.transaction_type == 'fulfillment' %}
            <span class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold uppercase bg-blue-100 text-blue-700 border border-blue-200">
                Fulfillment
            </span>
        {% elif transaction.transaction_type == 'refund' %}
            <span class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold uppercase bg-indigo-100 text-indigo-700 border border-indigo-200">
                Refund
            </span>
        {% endif %}
    </td>
    <!-- NOTE -->
    <td class="px-4 py-3 text-xs truncate max-w-[200px]"
        title="{{ transaction.note }}">
        {% if transaction.status == 'voided' %}
            <span class="italic">Voided: {{ transaction.note|default:"No notes" }}</span>
        {% else %}
            {{ transaction.note|default:"-" }}
        {% endif %}
    </td>
    <!-- AMOUNT -->
    <td class="px-4 py-3 text-right font-mono text-sm font-medium
               {% if transaction.status == 'voided' %}
                   line-through opacity-70
               {% elif transaction.transaction_type == 'deposit' or transaction.transaction_type == 'refund' %}
                   text-emerald-600
               {% else %}
                   text-red-600
               {% endif %}">
        {% if transaction.transaction_type == 'deposit' or transaction.transaction_type == 'refund' %}
            +
        {% else %}
            -
        {% endif %}
        {{ transaction.amount|floatformat:2|intcomma }}
    </td>
    <!-- ACTION -->
    <td class="px-4 py-3 text-center">
        {% if transaction.status == 'active' %}
            {% if transaction.transaction_type == 'deposit' or transaction.transaction_type == 'withdrawal' %}
                <!-- Manual Transactions: Allow Voiding -->
                <button hx-post="{% url 'void_transaction' transaction.pk %}"
                        hx-confirm="Are you sure you want to VOID this transaction? This will reverse the balance effect."
                        hx-target="#transaction-row-{{ transaction.pk }}"
                        hx-swap="outerHTML"
                        class="text-[10px] text-red-500 border border-red-200 bg-white px-2 py-1 rounded hover:bg-red-50 hover:border-red-400 transition-colors shadow-sm">
                    Void
                </button>
            {% else %}
                <!-- System Transactions: Disable Voiding (Must be done via Source) -->
                <span class="text-gray-300 cursor-not-allowed"
                      title="System transaction. Void the source (Sale/Agreement) to reverse.">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         viewBox="0 0 20 20"
                         fill="currentColor"
                         class="size-4 mx-auto">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16ZM8 7a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1V8a1 1 0 0 0-1-1H8Z" clip-rule="evenodd" />
                    </svg>
                </span>
            {% endif %}
        {% else %}
            <!-- Already Voided -->
            <span class="text-[10px] font-bold text-gray-500 bg-gray-200 px-2 py-1 rounded uppercase">Voided</span>
        {% endif %}
    </td>
</tr>
